<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player Alarm</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="flex w-full max-w-4xl">
        <div class="bg-white p-8 rounded shadow-md w-1/3">
            <h1 class="text-2xl font-bold mb-4 text-center">Now Playing</h1>
            <div id="nowPlaying" class="text-center text-red-500 mb-4"></div>
            <div class="text-center">
                <button id="pauseButton" class="bg-yellow-500 text-white px-2 py-1 rounded mr-2 hidden">Pause</button>
                <button id="playButton" class="bg-green-500 text-white px-2 py-1 rounded mr-2 hidden">Play</button>
                <button id="stopButton" class="bg-red-500 text-white px-2 py-1 rounded hidden">Stop</button>
            </div>
        </div>

        <div class="bg-white p-8 rounded shadow-md w-2/3 ml-4">
            <h1 class="text-2xl font-bold mb-4 text-center">Set Music Alarm</h1>
            <div class="mb-4">
                <label for="alarmTime" class="block text-gray-700">Alarm Time</label>
                <input type="datetime-local" id="alarmTime"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            <div class="mb-4">
                <label for="alarmSoundFile" class="block text-gray-700">Upload Music File (MP3)</label>
                <input type="file" id="alarmSoundFile" accept="audio/mpeg"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            <button id="setAlarmButton" class="w-full bg-indigo-500 text-white py-2 rounded-md hover:bg-indigo-600">Set
                Alarm</button>
            <div id="alarmMessage" class="mt-4 text-center text-red-500 hidden"></div>
            <div id="alarmsList" class="mt-4"></div>
        </div>
    </div>

    <audio id="alarmSound" preload="auto"></audio>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const setAlarmButton = document.getElementById("setAlarmButton");
            const alarmTimeInput = document.getElementById("alarmTime");
            const alarmSoundFileInput = document.getElementById("alarmSoundFile");
            const alarmMessage = document.getElementById("alarmMessage");
            const alarmsList = document.getElementById("alarmsList");
            const nowPlaying = document.getElementById("nowPlaying");
            const pauseButton = document.getElementById("pauseButton");
            const playButton = document.getElementById("playButton");
            const stopButton = document.getElementById("stopButton");
            const alarmSound = document.getElementById("alarmSound");

            let alarms = [];
            let currentAlarm = null;

            function setCurrentDateTime() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const formattedDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;
                alarmTimeInput.value = formattedDateTime;
            }

            setCurrentDateTime();

            setAlarmButton.addEventListener("click", () => {
                const alarmTime = alarmTimeInput.value;
                const files = alarmSoundFileInput.files;

                if (alarmTime && files.length > 0) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const alarmSoundSrc = e.target.result;
                        const alarmSoundName = files[0].name;

                        if (isTimeConflict(alarmTime)) {
                            alarmMessage.innerText = `Conflict: An alarm is already set for ${alarmTime}`;
                            alarmMessage.classList.remove("hidden");
                            return;
                        }

                        alarmMessage.classList.add("hidden");

                        const alarm = {
                            time: alarmTime,
                            soundSrc: alarmSoundSrc,
                            soundName: alarmSoundName,
                            timeoutId: scheduleAlarm(alarmTime, alarmSoundSrc, alarmSoundName)
                        };

                        alarms.push(alarm);

                        displayAlarms();
                    };
                    reader.readAsDataURL(files[0]);
                }
            });

            function isTimeConflict(alarmTime) {
                return alarms.some(alarm => alarm.time === alarmTime);
            }

            function scheduleAlarm(alarmTime, soundSrc, soundName) {
                const now = new Date();
                const alarmDate = new Date(alarmTime);
                const timeToAlarm = alarmDate.getTime() - now.getTime();

                return setTimeout(() => {
                    currentAlarm = { soundSrc, soundName };
                    alarmSound.src = soundSrc;
                    alarmSound.play();
                    updateNowPlaying(soundName, alarmTime);
                }, timeToAlarm);
            }

            pauseButton.addEventListener("click", () => {
                alarmSound.pause();
                pauseButton.classList.add("hidden");
                playButton.classList.remove("hidden");
            });

            playButton.addEventListener("click", () => {
                alarmSound.play();
                playButton.classList.add("hidden");
                pauseButton.classList.remove("hidden");
            });

            stopButton.addEventListener("click", () => {
                alarmSound.pause();
                alarmSound.currentTime = 0;
                pauseButton.classList.add("hidden");
                playButton.classList.add("hidden");
                stopButton.classList.add("hidden");
                nowPlaying.innerText = "";
                currentAlarm = null;
            });

            function displayAlarms() {
                alarmsList.innerHTML = "";
                alarms.forEach((alarm, index) => {
                    const alarmItem = document.createElement("div");
                    alarmItem.classList.add("flex", "justify-between", "items-center", "p-2", "border", "border-gray-300", "rounded", "mb-2");
                    alarmItem.innerHTML = `
                        <span>${alarm.time} - ${alarm.soundName}</span>
                        <button class="bg-red-500 text-white px-2 py-1 rounded" onclick="removeAlarm(${index})">Remove</button>
                    `;
                    alarmsList.appendChild(alarmItem);
                });
            }

            function updateNowPlaying(soundName, alarmTime) {
                alarmMessage.classList.remove("hidden");
                alarmMessage.classList.add("block");
                alarmMessage.innerText = `Playing: ${soundName} at ${alarmTime}`;
                nowPlaying.innerText = `Playing: ${soundName} at ${alarmTime}`;
                pauseButton.classList.remove("hidden");
                stopButton.classList.remove("hidden");
                playButton.classList.add("hidden");
            }

            window.removeAlarm = function (index) {
                clearTimeout(alarms[index].timeoutId);
                alarms.splice(index, 1);
                displayAlarms();
                if (alarms.length === 0) {
                    nowPlaying.innerText = "";
                }
            };
        });
    </script>
</body>

</html>
